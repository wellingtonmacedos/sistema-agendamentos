<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>Agendamento Chat</title>
    <script>
      (function() {
        // Dynamic Manifest Selection (Admin vs Client PWA)
        const isClient = window.location.pathname.startsWith('/chat') || window.location.pathname.startsWith('/public');
        let manifestPath = isClient ? '/manifest-client.json' : '/manifest.webmanifest';
        
        // If we are in a specific salon chat, use the dynamic manifest from backend
        const pathParts = window.location.pathname.split('/');
        // Format: /chat/salonId
        if (pathParts[1] === 'chat' && pathParts[2]) {
            const salonId = pathParts[2];
            manifestPath = `/dynamic-manifest/${salonId}`;
        }

        // Try to find existing link (in case injected) or create new
        // We observe DOM to catch if Vite injects it later
        const updateManifest = () => {
          let link = document.querySelector('link[rel="manifest"]');
          if (link) {
            // Check if we need to update the href
            if (link.href !== window.location.origin + manifestPath && !link.href.endsWith(manifestPath)) {
                link.href = manifestPath;
            }
          } else {
            link = document.createElement('link');
            link.rel = 'manifest';
            link.href = manifestPath;
            document.head.appendChild(link);
          }
        };

        updateManifest();
        // Observer in case it's injected later
        new MutationObserver(updateManifest).observe(document.head, { childList: true });
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
